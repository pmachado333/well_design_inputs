<!-- /index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Well Design Inputs - External</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      /* SLB palette */
      --slb-blue-900:#003E7E; --slb-blue-700:#005FB8; --slb-blue-100:#E8F2FB;
      --ink-900:#0B1324; --ink-500:#6B7280; --bg:#F7FAFD; --card:#FFFFFF; --ring:#CFE3F9;

      /* Sizes */
      --radius:14px; --shadow:0 4px 14px rgba(0,0,0,.08);
      --fs-title:26px; --fs-body:16px; --fs-label:13px; --fs-help:12px;
      --control-h:66px;                 /* ≈1.5× height */
      --chip-minw:100px;                /* readable chip width */
    }

    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink-900);background:var(--bg);font-size:var(--fs-body)}
    header{padding:28px 20px;background:linear-gradient(180deg,var(--slb-blue-700),var(--slb-blue-900));color:#fff;box-shadow:var(--shadow)}
    h1{margin:0 0 6px;font-size:var(--fs-title);font-weight:800}
    .subtitle{margin:0;opacity:.9;font-size:13px}
    main{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--ring);overflow:hidden}
    .card h2{margin:0;padding:14px 16px;font-size:15px;font-weight:700;color:var(--slb-blue-900);border-bottom:1px solid var(--ring);background:var(--slb-blue-100)}
    .card .body{padding:16px}

    .unit-row,.toggle-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .unit-row label,.toggle-row label{font-weight:700;font-size:var(--fs-label)}
    .help{margin:2px 0 0;font-size:var(--fs-help);color:var(--ink-500);flex-basis:100%}
    .unit-toggle{display:flex;gap:6px;background:#fff;border:1px solid var(--ring);border-radius:999px;padding:6px}
    .unit-toggle button{border:0;padding:10px 14px;border-radius:999px;background:transparent;cursor:pointer;font-weight:700;color:var(--slb-blue-900);font-size:14px}
    .unit-toggle button.active{background:var(--slb-blue-100)}
    .switch{display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff;font-size:14px}

    .fields-grid{display:grid;gap:18px;margin-top:8px;grid-template-columns:repeat(auto-fill,minmax(260px,320px));justify-content:space-between}
    .field-group{display:flex;flex-direction:column;gap:6px}
    .field-group label{font-weight:700;font-size:var(--fs-label)}

    /* ====== REMADE: inputs + unit chips use GRID for precise vertical centering ====== */
    .field{
      display:grid;
      grid-template-columns: 1fr auto;      /* input grows, chip stays tight */
      align-items:center;                    /* vertical centering */
      height:var(--control-h);
      background:#fff; border:1px solid var(--ring); border-radius:12px; overflow:hidden;
      transition:border-color .15s ease;
    }
    .field:focus-within{border-color:var(--slb-blue-700)}

    /* Input value: left-aligned, vertically centered, never under the chip */
    .field input[type="number"]{
      width:100%; min-width:0; border:0; outline:none;
      height:100%;                         /* fill container for true centering */
      padding:0 14px;                      /* clean side padding */
      background:#fff; color:var(--ink-900);
      font-size:var(--fs-body); font-weight:700; line-height:1; /* crisp baseline */
      text-align:left; font-variant-numeric:tabular-nums;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .field input::placeholder{color:#97A3B6}
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    input[type=number]{-moz-appearance:textfield}

    /* Unit chips: same height, centered text, strong contrast */
    .suffix,.unit-select{
      align-self:stretch;                   /* chip fills full height */
      display:flex; align-items:center; justify-content:center;
      padding:0 12px;                       /* compact */
      border-left:1px solid var(--ring);
      background:#EEF5FF;                   /* slightly darker for readability */
      color:var(--slb-blue-900);
      font-weight:700; font-size:15px; white-space:nowrap; text-align:center;
    }
    .unit-select select{
      border:0; background:transparent; outline:none; cursor:pointer;
      height:100%; min-width:var(--chip-minw);
      font:inherit; color:inherit; line-height:1;
      text-align:center; text-align-last:center;
      appearance:none;                      /* consistent baseline across browsers */
    }
    /* ====== / REMADE ====== */

    .actions{display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--ring);background:#FBFDFF}
    .btn{appearance:none;border:1px solid var(--slb-blue-700);color:#fff;background:var(--slb-blue-700);padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;font-size:14px}
    .btn.secondary{background:#fff;color:var(--slb-blue-700)}
    details.preview{margin-top:16px}
    details.preview>summary{list-style:none;cursor:pointer;padding:14px 16px;background:var(--slb-blue-100);color:var(--slb-blue-900);font-weight:700;border:1px solid var(--ring);border-radius:var(--radius)}
    details.preview>summary::-webkit-details-marker{display:none}
    details.preview pre{margin:8px 0 0;padding:14px;font-size:12px;line-height:1.4;overflow:auto;white-space:pre;background:#0B1220;color:#E8F2FB;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <h1>Well Design Inputs – External</h1>
    <p class="subtitle">Prototype Version</p>
  </header>

  <main>
    <section class="card">
      <h2>Inputs</h2>
      <div class="body">
        <div class="unit-row">
          <label>Unit System</label>
          <div class="unit-toggle" role="radiogroup" aria-label="Unit System">
            <button id="metricBtn" data-unit="metric" class="active" aria-pressed="true">Metric (m)</button>
            <button id="imperialBtn" data-unit="imperial" aria-pressed="false">Imperial (ft)</button>
          </div>
          <p class="help">All length, cost-per-length, and DLS use one system. Values auto-convert.</p>
        </div>

        <div class="toggle-row">
          <label>Modelling Options</label>
          <label class="switch"><input type="checkbox" id="well_trajectory_modelling" checked /> Well trajectory modelling</label>
          <label class="switch"><input type="checkbox" id="allow_incomplete_dev_concept" /> Allow incomplete development concept</label>
          <p class="help">Enable trajectory modelling; optionally allow saving with incomplete development inputs.</p>
        </div>

        <div class="fields-grid">
          <div class="field-group">
            <label for="well_unit_cost">Well unit cost</label>
            <div class="field">
              <input id="well_unit_cost" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 15500" />
              <div class="unit-select">
                <select id="well_cost_unit" aria-label="Cost unit">
                  <option value="USD/m">USD/m</option>
                  <option value="USD/ft">USD/ft</option>
                </select>
              </div>
            </div>
            <div class="help">Estimated drilling/completion cost per length.</div>
          </div>

          <div class="field-group">
            <label for="tubing_size">Tubing size</label>
            <div class="field">
              <input id="tubing_size" type="number" min="0" step="0.001" inputmode="decimal" placeholder="e.g. 6.625" />
              <div class="suffix" aria-hidden="true">in</div>
            </div>
            <div class="help">Production tubing outer diameter (fixed in inches).</div>
          </div>

          <div class="field-group">
            <label for="horizontal_step_out">Horizontal step-out</label>
            <div class="field">
              <input id="horizontal_step_out" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 800" />
              <div id="hso_unit" class="suffix" aria-hidden="true">m</div>
            </div>
            <div class="help">Surface-to-target horizontal distance.</div>
          </div>

          <div class="field-group">
            <label for="kickoff_point">Kickoff point</label>
            <div class="field">
              <input id="kickoff_point" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 600" />
              <div id="kop_unit" class="suffix" aria-hidden="true">m</div>
            </div>
            <div class="help">Measured depth where deviation starts.</div>
          </div>

          <div class="field-group">
            <label for="dls_limit">DLS limit</label>
            <div class="field">
              <input id="dls_limit" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 3" />
              <div id="dls_unit" class="suffix" aria-hidden="true">°/30 m</div>
            </div>
            <div class="help">Max dogleg severity (°/30 m or °/100 ft).</div>
          </div>
        </div>

        <p class="note">Multilateral well design is fixed to <strong>false</strong> and hidden.</p>
      </div>

      <div class="actions">
        <button id="resetBtn" class="btn secondary" type="button">Reset to defaults</button>
        <button id="downloadBtn" class="btn" type="button">Download JSON</button>
      </div>
    </section>

    <details class="preview" id="jsonDetails">
      <summary>JSON Preview (live)</summary>
      <pre id="jsonPreview" aria-live="polite"></pre>
    </details>
  </main>

  <script>
    const UOM = {
      length: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:m:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:ft:"
      },
      cost: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fm:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fft:"
      },
      tubingInch: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:in:",
      dls: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:1%2F30%20dega%2Fm:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:0.01%20dega%2Fft:"
      }
    };

    const defaults = {
      unitSystem: "metric",
      well_trajectory_modelling: true,
      allow_incomplete_dev_concept: false,
      well_unit_cost: 15500,
      tubing_size: 6.625,
      horizontal_step_out: 800,
      kickoff_point: 600,
      dls_limit: 3
    };

    const M_PER_FT = 0.3048;
    const FT_PER_M = 1 / M_PER_FT;
    const DLS_M_TO_FT = 100 / (30 * FT_PER_M);
    const DLS_FT_TO_M = 1 / DLS_M_TO_FT;

    const state = JSON.parse(JSON.stringify(defaults));

    const metricBtn = document.getElementById("metricBtn");
    const imperialBtn = document.getElementById("imperialBtn");
    const costInput = document.getElementById("well_unit_cost");
    const costUnitSel = document.getElementById("well_cost_unit");
    const tubingInput = document.getElementById("tubing_size");
    const hsoInput = document.getElementById("horizontal_step_out");
    const kopInput = document.getElementById("kickoff_point");
    const dlsInput = document.getElementById("dls_limit");
    const jsonPreview = document.getElementById("jsonPreview");
    const resetBtn = document.getElementById("resetBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const hsoUnit = document.getElementById("hso_unit");
    const kopUnit = document.getElementById("kop_unit");
    const dlsUnit = document.getElementById("dls_unit");
    const trajChk = document.getElementById("well_trajectory_modelling");
    const allowIncompleteChk = document.getElementById("allow_incomplete_dev_concept");

    function clampNonNeg(n){ return Math.max(0, Number(n) || 0); }

    function syncInputsFromState(){
      trajChk.checked = state.well_trajectory_modelling;
      allowIncompleteChk.checked = state.allow_incomplete_dev_concept;

      costInput.value = state.well_unit_cost.toFixed(2);
      costUnitSel.value = state.unitSystem === "metric" ? "USD/m" : "USD/ft";

      tubingInput.value = state.tubing_size;
      hsoInput.value = state.horizontal_step_out.toFixed(2);
      kopInput.value = state.kickoff_point.toFixed(2);
      dlsInput.value = state.dls_limit.toFixed(3);

      const isMetric = state.unitSystem === "metric";
      hsoUnit.textContent = isMetric ? "m" : "ft";
      kopUnit.textContent = isMetric ? "m" : "ft";
      dlsUnit.textContent = isMetric ? "°/30 m" : "°/100 ft";

      metricBtn.classList.toggle("active", isMetric);
      metricBtn.setAttribute("aria-pressed", String(isMetric));
      imperialBtn.classList.toggle("active", !isMetric);
      imperialBtn.setAttribute("aria-pressed", String(!isMetric));

      renderJSON();
    }

    function buildPayload(){
      const isMetric = state.unitSystem === "metric";
      return {
        well_trajectory_modelling: !!state.well_trajectory_modelling,
        allow_incomplete_dev_concept: !!state.allow_incomplete_dev_concept,
        multilateral_well_modelling: { multilateral_well_design: false },
        well_unit_cost: roundNum(state.well_unit_cost, 2),
        well_unit_cost_measurement: isMetric ? UOM.cost.metric : UOM.cost.imperial,
        tubing_size: roundNum(state.tubing_size, 3),
        tubing_size_measurement: UOM.tubingInch,
        horizontal_step_out: roundNum(state.horizontal_step_out, 2),
        horizontal_step_out_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        kickoff_point: roundNum(state.kickoff_point, 2),
        kickoff_point_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        dls_limit: roundNum(state.dls_limit, 3),
        dls_limit_measurement: isMetric ? UOM.dls.metric : UOM.dls.imperial
      };
    }

    function roundNum(v, digits){
      const f = Math.pow(10, digits);
      return Math.round((Number(v)||0) * f) / f;
    }

    function renderJSON(){
      jsonPreview.textContent = JSON.stringify(buildPayload(), null, 2);
    }

    function setUnitSystem(target){
      if(target === state.unitSystem) return;
      const toImperial = target === "imperial";
      if(toImperial){
        state.horizontal_step_out *= FT_PER_M;
        state.kickoff_point     *= FT_PER_M;
        state.well_unit_cost    *= M_PER_FT;    // USD/m -> USD/ft
        state.dls_limit         *= DLS_M_TO_FT; // °/30m -> °/100ft
      }else{
        state.horizontal_step_out *= M_PER_FT;
        state.kickoff_point     *= M_PER_FT;
        state.well_unit_cost    *= FT_PER_M;    // USD/ft -> USD/m
        state.dls_limit         *= DLS_FT_TO_M; // °/100ft -> °/30m
      }
      state.unitSystem = target;
      syncInputsFromState();
    }

    metricBtn.addEventListener("click", ()=> setUnitSystem("metric"));
    imperialBtn.addEventListener("click", ()=> setUnitSystem("imperial"));

    costUnitSel.addEventListener("change", (e)=>{
      const desired = e.target.value.endsWith("/m") ? "metric" : "imperial";
      setUnitSystem(desired);
    });

    costInput.addEventListener("input", (e)=>{ state.well_unit_cost = clampNonNeg(e.target.value); renderJSON(); });
    tubingInput.addEventListener("input", (e)=>{ state.tubing_size = clampNonNeg(e.target.value); renderJSON(); });
    hsoInput.addEventListener("input", (e)=>{ state.horizontal_step_out = clampNonNeg(e.target.value); renderJSON(); });
    kopInput.addEventListener("input", (e)=>{ state.kickoff_point = clampNonNeg(e.target.value); renderJSON(); });
    dlsInput.addEventListener("input", (e)=>{ state.dls_limit = clampNonNeg(e.target.value); renderJSON(); });
    trajChk.addEventListener("change", (e)=>{ state.well_trajectory_modelling = !!e.target.checked; renderJSON(); });
    allowIncompleteChk.addEventListener("change", (e)=>{ state.allow_incomplete_dev_concept = !!e.target.checked; renderJSON(); });

    resetBtn.addEventListener("click", ()=>{
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();
    });

    downloadBtn.addEventListener("click", ()=>{
      const data = JSON.stringify(buildPayload(), null, 2);
      const blob = new Blob([data], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "well-design-inputs.json";
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      a.remove();
    });

    (function init(){
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();
    })();
  </script>
</body>
</html>
