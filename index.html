<!-- Well Design Inputs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Well Design Inputs - External</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      /* SLB blues (tweak if you have official tokens) */
      --slb-blue-900:#003E7E;
      --slb-blue-800:#004E9A;
      --slb-blue-700:#005FB8;
      --slb-blue-600:#0072C6;
      --slb-blue-100:#E8F2FB;
      --ink-900:#0B1324;
      --ink-700:#293345;
      --ink-500:#6B7280;
      --bg:#F7FAFD;
      --card:#FFFFFF;
      --ring:#CFE3F9;
      --ok:#116149;
      --warn:#8A4B0F;
      --radius:16px;
      --shadow:0 4px 14px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink-900); background:var(--bg);
    }
    header{
      padding:28px 20px; background:linear-gradient(180deg, var(--slb-blue-700), var(--slb-blue-900));
      color:#fff; box-shadow:var(--shadow);
    }
    h1{margin:0 0 6px; font-size:26px; font-weight:800; letter-spacing:.2px}
    .subtitle{margin:0; opacity:.9; font-size:14px}
    main{max-width:1100px; margin:24px auto; padding:0 16px}
    .grid{display:grid; gap:16px}
    @media(min-width:900px){ .grid{grid-template-columns: 1.1fr 1fr} }
    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid var(--ring)}
    .card h2{margin:0; padding:16px 18px; font-size:16px; font-weight:700; color:var(--slb-blue-900); border-bottom:1px solid var(--ring); background:var(--slb-blue-100)}
    .card .body{padding:18px}
    .row{display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center; margin-bottom:14px}
    .row label{font-weight:600; font-size:14px}
    .help{grid-column:1/-1; margin:4px 0 0; font-size:12px; color:var(--ink-500)}
    .field{
      display:flex; align-items:stretch; border:1px solid var(--ring); border-radius:12px; background:#fff; overflow:hidden;
    }
    .field input[type="number"]{
      width:100%; border:0; padding:12px 12px; font-size:14px; outline:none;
    }
    .suffix, .unit-select{
      display:flex; align-items:center; padding:0 10px; border-left:1px solid var(--ring); background:#FAFCFF; font-weight:600; color:var(--slb-blue-900)
    }
    .unit-select select{
      border:0; background:transparent; padding:10px 0; font-weight:600; color:var(--slb-blue-900); outline:none; cursor:pointer;
    }
    .switches{display:flex; gap:10px; flex-wrap:wrap}
    .switch{
      display:flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid var(--ring); border-radius:12px; background:#fff;
    }
    .unit-toggle{display:flex; gap:8px; background:#fff; border:1px solid var(--ring); border-radius:999px; padding:4px}
    .unit-toggle button{
      border:0; padding:8px 12px; border-radius:999px; background:transparent; cursor:pointer; font-weight:700; color:var(--slb-blue-900)
    }
    .unit-toggle button.active{background:var(--slb-blue-100);}
    pre{
      margin:0; padding:16px; font-size:12px; line-height:1.4; overflow:auto; white-space:pre; background:#0B1220; color:#E8F2FB; border-bottom-left-radius:var(--radius); border-bottom-right-radius:var(--radius);
    }
    .actions{display:flex; gap:10px; justify-content:flex-end; padding:14px 18px; border-top:1px solid var(--ring); background:#FBFDFF; border-bottom-left-radius:var(--radius); border-bottom-right-radius:var(--radius)}
    .btn{
      appearance:none; border:1px solid var(--slb-blue-700); color:#fff; background:var(--slb-blue-700);
      padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
    }
    .btn.secondary{background:#fff; color:var(--slb-blue-700)}
    .note{font-size:12px; color:var(--ink-500); margin-top:8px}
    .error{color:var(--warn); font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>Well Design Inputs – External</h1>
    <p class="subtitle">Prototype Version</p>
  </header>

  <main class="grid">
    <section class="card">
      <h2>Inputs</h2>
      <div class="body">
        <!-- Unit system -->
        <div class="row">
          <label for="unitSystem">Unit System</label>
          <div class="unit-toggle" role="radiogroup" aria-label="Unit System">
            <button id="metricBtn" data-unit="metric" class="active" aria-pressed="true">Metric (m)</button>
            <button id="imperialBtn" data-unit="imperial" aria-pressed="false">Imperial (ft)</button>
          </div>
          <p class="help">Choose the unit system. All fields and measurements stay consistent (meters or feet). Values auto-convert.</p>
        </div>

        <!-- Feature toggles -->
        <div class="row">
          <label>Modelling Options</label>
          <div class="switches">
            <label class="switch"><input type="checkbox" id="well_trajectory_modelling" checked /> Well trajectory modelling</label>
            <label class="switch"><input type="checkbox" id="allow_incomplete_dev_concept" /> Allow incomplete development concept</label>
          </div>
          <p class="help">Enable trajectory modelling, or allow saving even if some development inputs are incomplete.</p>
        </div>

        <!-- Well unit cost -->
        <div class="row">
          <label for="well_unit_cost">Well unit cost</label>
          <div class="field">
            <input id="well_unit_cost" type="number" min="0" step="0.01" inputmode="decimal" />
            <div class="unit-select">
              <select id="well_cost_unit">
                <option value="USD/m">USD/m</option>
                <option value="USD/ft">USD/ft</option>
              </select>
            </div>
          </div>
          <p class="help">Estimated drilling/completion cost per length of wellbore.</p>
        </div>

        <!-- Tubing size -->
        <div class="row">
          <label for="tubing_size">Tubing size</label>
          <div class="field">
            <input id="tubing_size" type="number" min="0" step="0.001" inputmode="decimal" />
            <div class="suffix" aria-hidden="true">in</div>
          </div>
          <p class="help">Outer diameter of production tubing. Measured in inches (fixed).</p>
        </div>

        <!-- Horizontal step out -->
        <div class="row">
          <label for="horizontal_step_out">Horizontal step-out</label>
          <div class="field">
            <input id="horizontal_step_out" type="number" min="0" step="0.01" inputmode="decimal" />
            <div id="hso_unit" class="suffix" aria-hidden="true">m</div>
          </div>
          <p class="help">Horizontal distance from surface location to the target. Controls reach.</p>
        </div>

        <!-- Kickoff point -->
        <div class="row">
          <label for="kickoff_point">Kickoff point</label>
          <div class="field">
            <input id="kickoff_point" type="number" min="0" step="0.01" inputmode="decimal" />
            <div id="kop_unit" class="suffix" aria-hidden="true">m</div>
          </div>
          <p class="help">Measured depth where the well deviates from vertical.</p>
        </div>

        <!-- DLS limit -->
        <div class="row">
          <label for="dls_limit">DLS limit</label>
          <div class="field">
            <input id="dls_limit" type="number" min="0" step="0.01" inputmode="decimal" />
            <div id="dls_unit" class="suffix" aria-hidden="true">°/30 m</div>
          </div>
          <p class="help">Maximum dogleg severity (average change in inclination/azimuth per standardized interval).</p>
        </div>

        <p class="note">Note: Multilateral well design is fixed to <strong>false</strong> and is not shown.</p>
      </div>

      <div class="actions">
        <button id="resetBtn" class="btn secondary" type="button">Reset to defaults</button>
        <button id="downloadBtn" class="btn" type="button">Download JSON</button>
      </div>
    </section>

    <section class="card">
      <h2>JSON Preview</h2>
      <pre id="jsonPreview" aria-live="polite"></pre>
    </section>
  </main>

  <script>
    // Why: Keep unit consistency + correct OSDU measurement references.
    const UOM = {
      length: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:m:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:ft:"
      },
      cost: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fm:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fft:"
      },
      tubingInch: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:in:",
      dls: {
        metric: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:1%2F30%20dega%2Fm:",
        imperial: "slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:0.01%20dega%2Fft:"
      }
    };

    const defaults = {
      unitSystem: "metric",
      well_trajectory_modelling: true,
      allow_incomplete_dev_concept: false,
      well_unit_cost: 15500,          // USD/m default
      tubing_size: 6.625,             // in
      horizontal_step_out: 800,       // m
      kickoff_point: 600,             // m
      dls_limit: 3                    // deg/30 m
    };

    // Conversions
    const M_PER_FT = 0.3048;
    const FT_PER_M = 1 / M_PER_FT;
    const DLS_M_TO_FT = 100 / (30 * FT_PER_M);   // ≈ 1.016, from deg/30m -> deg/100ft
    const DLS_FT_TO_M = 1 / DLS_M_TO_FT;

    // State
    const state = JSON.parse(JSON.stringify(defaults));

    // Elements
    const metricBtn = document.getElementById("metricBtn");
    const imperialBtn = document.getElementById("imperialBtn");
    const costInput = document.getElementById("well_unit_cost");
    const costUnitSel = document.getElementById("well_cost_unit");
    const tubingInput = document.getElementById("tubing_size");
    const hsoInput = document.getElementById("horizontal_step_out");
    const kopInput = document.getElementById("kickoff_point");
    const dlsInput = document.getElementById("dls_limit");
    const jsonPreview = document.getElementById("jsonPreview");
    const resetBtn = document.getElementById("resetBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const hsoUnit = document.getElementById("hso_unit");
    const kopUnit = document.getElementById("kop_unit");
    const dlsUnit = document.getElementById("dls_unit");
    const trajChk = document.getElementById("well_trajectory_modelling");
    const allowIncompleteChk = document.getElementById("allow_incomplete_dev_concept");

    function clampNonNeg(n){ return Math.max(0, Number(n) || 0); }

    function syncInputsFromState(){
      // Push state into inputs
      trajChk.checked = state.well_trajectory_modelling;
      allowIncompleteChk.checked = state.allow_incomplete_dev_concept;

      costInput.value = state.well_unit_cost.toFixed(2);
      costUnitSel.value = state.unitSystem === "metric" ? "USD/m" : "USD/ft";

      tubingInput.value = state.tubing_size;

      hsoInput.value = state.horizontal_step_out.toFixed(2);
      kopInput.value = state.kickoff_point.toFixed(2);
      dlsInput.value = state.dls_limit.toFixed(3);

      // Units
      const isMetric = state.unitSystem === "metric";
      hsoUnit.textContent = isMetric ? "m" : "ft";
      kopUnit.textContent = isMetric ? "m" : "ft";
      dlsUnit.textContent = isMetric ? "°/30 m" : "°/100 ft";

      metricBtn.classList.toggle("active", isMetric);
      metricBtn.setAttribute("aria-pressed", String(isMetric));
      imperialBtn.classList.toggle("active", !isMetric);
      imperialBtn.setAttribute("aria-pressed", String(!isMetric));

      renderJSON();
    }

    function buildPayload(){
      const isMetric = state.unitSystem === "metric";
      return {
        well_trajectory_modelling: !!state.well_trajectory_modelling,
        allow_incomplete_dev_concept: !!state.allow_incomplete_dev_concept,
        multilateral_well_modelling: { multilateral_well_design: false },
        well_unit_cost: roundNum(state.well_unit_cost, 2),
        well_unit_cost_measurement: isMetric ? UOM.cost.metric : UOM.cost.imperial,
        tubing_size: roundNum(state.tubing_size, 3),
        tubing_size_measurement: UOM.tubingInch,
        horizontal_step_out: roundNum(state.horizontal_step_out, 2),
        horizontal_step_out_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        kickoff_point: roundNum(state.kickoff_point, 2),
        kickoff_point_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        dls_limit: roundNum(state.dls_limit, 3),
        dls_limit_measurement: isMetric ? UOM.dls.metric : UOM.dls.imperial
      };
    }

    function roundNum(v, digits){
      const f = Math.pow(10, digits);
      return Math.round((Number(v)||0) * f) / f;
    }

    function renderJSON(){
      jsonPreview.textContent = JSON.stringify(buildPayload(), null, 2);
    }

    function setUnitSystem(target){
      if(target === state.unitSystem) return;
      const toImperial = target === "imperial";
      // Convert values to the new system
      if(toImperial){
        state.horizontal_step_out *= FT_PER_M;
        state.kickoff_point     *= FT_PER_M;
        state.well_unit_cost    *= M_PER_FT;    // USD/m -> USD/ft
        state.dls_limit         *= DLS_M_TO_FT; // deg/30m -> deg/100ft
      }else{
        state.horizontal_step_out *= M_PER_FT;
        state.kickoff_point     *= M_PER_FT;
        state.well_unit_cost    *= FT_PER_M;    // USD/ft -> USD/m
        state.dls_limit         *= DLS_FT_TO_M; // deg/100ft -> deg/30m
      }
      state.unitSystem = target;
      syncInputsFromState();
    }

    // Event wiring
    metricBtn.addEventListener("click", ()=> setUnitSystem("metric"));
    imperialBtn.addEventListener("click", ()=> setUnitSystem("imperial"));

    costUnitSel.addEventListener("change", (e)=>{
      const val = e.target.value; // "USD/m" or "USD/ft"
      const desired = val.endsWith("/m") ? "metric" : "imperial";
      // Enforce global consistency by switching system
      setUnitSystem(desired);
    });

    costInput.addEventListener("input", (e)=>{
      state.well_unit_cost = clampNonNeg(e.target.value);
      renderJSON();
    });

    tubingInput.addEventListener("input", (e)=>{
      state.tubing_size = clampNonNeg(e.target.value);
      renderJSON();
    });

    hsoInput.addEventListener("input", (e)=>{
      state.horizontal_step_out = clampNonNeg(e.target.value);
      renderJSON();
    });

    kopInput.addEventListener("input", (e)=>{
      state.kickoff_point = clampNonNeg(e.target.value);
      renderJSON();
    });

    dlsInput.addEventListener("input", (e)=>{
      state.dls_limit = clampNonNeg(e.target.value);
      renderJSON();
    });

    trajChk.addEventListener("change", (e)=>{
      state.well_trajectory_modelling = !!e.target.checked;
      renderJSON();
    });

    allowIncompleteChk.addEventListener("change", (e)=>{
      state.allow_incomplete_dev_concept = !!e.target.checked;
      renderJSON();
    });

    resetBtn.addEventListener("click", ()=>{
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();
    });

    downloadBtn.addEventListener("click", ()=>{
      const data = JSON.stringify(buildPayload(), null, 2);
      const blob = new Blob([data], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "well-design-inputs.json";
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      a.remove();
    });

    // Init
    (function init(){
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();
    })();
  </script>
</body>
</html>
