<!-- Well Design Inputs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Well Design Inputs - External</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --slb-blue-900:#003E7E; --slb-blue-700:#005FB8; --slb-blue-100:#E8F2FB;
      --ink-900:#0B1324; --ink-500:#6B7280; --bg:#F7FAFD; --card:#FFFFFF; --ring:#CFE3F9;
      --radius:14px; --shadow:0 4px 14px rgba(0,0,0,.08);
      --fs-title:26px; --fs-body:16px; --fs-label:13px; --fs-help:12px;
      --control-h:66px; --chip-minw:50px; --col-min:160px; --col-max:180px;
      --schematic-h:480px;
    }

    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink-900);background:var(--bg);font-size:var(--fs-body)}
    header{padding:28px 20px;background:linear-gradient(180deg,var(--slb-blue-700),var(--slb-blue-900));color:#fff;box-shadow:var(--shadow)}
    h1{margin:0 0 6px;font-size:var(--fs-title);font-weight:800}
    .subtitle{margin:0;opacity:.9;font-size:13px}

    .main-grid{
      max-width:1280px; margin:24px auto; padding:0 16px;
      display:grid; gap:16px; grid-template-columns:minmax(0,1fr) 460px; align-items:start;
    }
    .main-grid.schem-hidden{ grid-template-columns:1fr; }
    @media (max-width:1100px){ .main-grid{ grid-template-columns:1fr; } }

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--ring);overflow:hidden}
    .card h2{margin:0;padding:14px 16px;font-size:15px;font-weight:700;color:var(--slb-blue-900);border-bottom:1px solid var(--ring);background:var(--slb-blue-100)}
    .card .body{padding:16px}

    .unit-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .unit-row label{font-weight:700;font-size:var(--fs-label)}
    .help{margin:4px 0 0;font-size:var(--fs-help);color:var(--ink-500);flex-basis:100%}

    .unit-toggle{display:flex;gap:6px;background:#fff;border:1px solid var(--ring);border-radius:999px;padding:6px}
    .unit-toggle button{border:0;padding:10px 14px;border-radius:999px;background:transparent;cursor:pointer;font-weight:700;color:#003E7E;font-size:14px}
    .unit-toggle button.active{background:var(--slb-blue-100)}

    .fields-grid{
      display:grid; gap:14px; margin-top:8px;
      grid-template-columns:repeat(auto-fill,minmax(var(--col-min),var(--col-max)));
      justify-content:start;
    }
    .field-group{display:flex;flex-direction:column;gap:6px}
    .field-group label{font-weight:700;font-size:var(--fs-label)}

    .field{
      display:grid; grid-template-columns:1fr auto; align-items:center;
      height:var(--control-h); background:#fff; border:1px solid var(--ring); border-radius:12px; overflow:hidden;
      transition:border-color .15s ease;
    }
    .field:focus-within{border-color:var(--slb-blue-700)}

    .field input[type="number"]{
      width:100%; min-width:0; border:0; outline:none; height:100%; padding:0 8px;
      background:#fff; color:#0B1324; font-size:var(--fs-body); font-weight:700; line-height:1;
      text-align:left; font-variant-numeric:tabular-nums;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .field input::placeholder{color:#97A3B6}
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
    input[type=number]{ -moz-appearance:textfield }

    .suffix,.unit-select{
      align-self:stretch; display:flex; align-items:center; justify-content:center;
      padding:0 8px; border-left:1px solid var(--ring); background:#EEF5FF; color:#003E7E;
      font-weight:700; font-size:15px; white-space:nowrap; text-align:center;
    }
    .unit-select select{
      border:0; background:transparent; outline:none; cursor:pointer;
      height:100%; min-width:var(--chip-minw); font:inherit; color:inherit; line-height:1;
      text-align:center; text-align-last:center; appearance:none;
    }

    .actions{display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--ring);background:#FBFDFF}
    .btn{appearance:none;border:1px solid var(--slb-blue-700);color:#fff;background:var(--slb-blue-700);padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;font-size:14px}
    .btn.secondary{background:#fff;color:#005FB8}
    .btn.sm{padding:6px 10px;font-size:12px;border-radius:8px}

    details.preview{max-width:1280px;margin:16px auto 24px;padding:0 16px}
    details.preview>summary{list-style:none;cursor:pointer;padding:14px 16px;background:var(--slb-blue-100);color:#003E7E;font-weight:700;border:1px solid var(--ring);border-radius:var(--radius)}
    details.preview>summary::-webkit-details-marker{display:none}
    details.preview pre{margin:8px 0 0;padding:14px;font-size:12px;line-height:1.4;overflow:auto;white-space:pre;background:#0B1220;color:#E8F2FB;border-radius:10px}

    .schematic-wrap{padding:12px}
    #schematic{
      width:100%; height:var(--schematic-h); display:block; background:#fff;
      border:1px solid var(--ring); border-radius:12px;
    }

    .ns{ vector-effect: non-scaling-stroke; }
    .halo{ paint-order: stroke; stroke:#fff; stroke-width:4px; }
    .wedge{ stroke:#005FB8; stroke-width:3; stroke-linecap:round; fill:none; }
  </style>
</head>
<body>
  <header>
    <h1>Well Design Inputs – External</h1>
    <p class="subtitle">Prototype Version</p>
  </header>

  <div class="main-grid" id="mainGrid">
    <section class="card">
      <h2>Inputs</h2>
      <div class="body">
        <div class="unit-row">
          <label>Unit System</label>
          <div class="unit-toggle" role="radiogroup" aria-label="Unit System">
            <button id="metricBtn" data-unit="metric" class="active" aria-pressed="true">Metric (m)</button>
            <button id="imperialBtn" data-unit="imperial" aria-pressed="false">Imperial (ft)</button>
          </div>
          <p class="help">Sets units for length, cost per length, and DLS; values auto-convert.</p>
        </div>

        <div class="unit-row" style="margin-top:0">
          <label>Modelling</label>
          <label><input type="checkbox" id="well_trajectory_modelling" checked /> Well trajectory modelling</label>
          <p class="help">Enables the well trajectory optimizer. If switched off, well trajectories are generated as straight lines.</p>
        </div>

        <div class="unit-row" style="margin-top:0">
          <label>Schematic</label>
          <button id="schemToggle" class="btn secondary sm" aria-pressed="true">Hide schematic</button>
          <p class="help">Show or hide the right-side well design schematic.</p>
        </div>

        <div class="fields-grid">
          <div class="field-group">
            <label for="well_unit_cost">Well unit cost</label>
            <div class="field">
              <input id="well_unit_cost" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 15500" />
              <div class="unit-select">
                <select id="well_cost_unit" aria-label="Cost unit">
                  <option value="USD/m">USD/m</option>
                  <option value="USD/ft">USD/ft</option>
                </select>
              </div>
            </div>
            <div class="help">Average total cost per unit of drilled and completed length.</div>
          </div>

          <div class="field-group">
            <label for="tubing_size">Tubing size</label>
            <div class="field">
              <input id="tubing_size" type="number" min="0" step="0.001" inputmode="decimal" placeholder="e.g. 6.625" />
              <div class="suffix" aria-hidden="true">in</div>
            </div>
            <div class="help">Nominal outer diameter of the production tubing (inches).</div>
          </div>

          <div class="field-group">
            <label for="horizontal_step_out">Horizontal step-out</label>
            <div class="field">
              <input id="horizontal_step_out" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 800" />
              <div id="hso_unit" class="suffix" aria-hidden="true">m</div>
            </div>
            <div class="help">Horizontal map distance from the wellhead to the target location.</div>
          </div>

          <!-- Will hide/show as a whole when modelling toggles -->
          <div class="field-group" id="group_kop">
            <label for="kickoff_point">Kickoff point</label>
            <div class="field">
              <input id="kickoff_point" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 600" />
              <div id="kop_unit" class="suffix" aria-hidden="true">m</div>
            </div>
            <div class="help">Measured depth where the wellpath starts the build (curved) section.</div>
          </div>

          <!-- Will hide/show as a whole when modelling toggles -->
          <div class="field-group" id="group_dls">
            <label for="dls_limit">DLS limit</label>
            <div class="field">
              <input id="dls_limit" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g. 4" />
              <div id="dls_unit" class="suffix" aria-hidden="true">°/30 m</div>
            </div>
            <div class="help">Maximum allowed dogleg severity of the trajectory.</div>
          </div>
        </div>

        <div class="actions">
          <button id="resetBtn" class="btn secondary" type="button">Reset to defaults</button>
          <button id="downloadBtn" class="btn" type="button">Download JSON</button>
        </div>
      </div>
    </section>

    <section class="card" id="schemCard">
      <h2>Well Design Schematic</h2>
      <div class="schematic-wrap" id="schemWrap">
        <svg id="schematic" viewBox="0 0 620 460" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Well trajectory schematic">
          <defs>
            <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
              <path d="M0,0 L10,5 L0,10 Z" fill="#005FB8"></path>
            </marker>
          </defs>

          <!-- Wellhead symbol -->
          <g transform="translate(140,80)">
            <rect x="-8" y="-4" width="16" height="8" fill="#005FB8" rx="2"></rect>
            <rect x="-3" y="-18" width="6" height="14" fill="#005FB8" rx="1"></rect>
          </g>

          <!-- ===== Mode A: SIMPLE (modelling OFF) ===== -->
          <g id="schem-simple">
            <line class="ns" x1="180" y1="64" x2="520" y2="64" stroke="#005FB8" stroke-width="2" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
            <text class="halo" x="350" y="50" text-anchor="middle" font-size="12" fill="#003E7E">Horizontal step-out</text>

            <!-- OFF: one clean incline from wellhead to target -->
            <path class="ns" d="M 140 80 L 520 440" stroke="#003E7E" stroke-width="3.5" stroke-linecap="round" fill="none"></path>

            <g transform="translate(520,440)">
              <circle r="7" stroke="#005FB8" stroke-width="2" fill="none"></circle>
              <line x1="-9" y1="0" x2="9" y2="0" stroke="#005FB8" stroke-width="2"></line>
              <line x1="0" y1="-9" x2="0" y2="9" stroke="#005FB8" stroke-width="2"></line>
            </g>
            <text class="halo" x="534" y="428" font-size="12" fill="#0B1324">Target</text>
          </g>

          <!-- ===== Mode B: OPTIMIZED S-SHAPE (modelling ON) ===== -->
          <g id="schem-optim" style="display:none">
            <line class="ns" x1="180" y1="64" x2="430" y2="64" stroke="#005FB8" stroke-width="2" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
            <text class="halo" x="305" y="50" text-anchor="middle" font-size="12" fill="#003E7E">Horizontal step-out</text>

            <!-- shorter vertical kickoff -->
            <path class="ns" d="M 140 80 L 140 220" stroke="#005FB8" stroke-width="3.5" stroke-linecap="round" fill="none"></path>

            <!-- re-anchored S-curve -->
            <path class="ns" d="
              M 140 220
              C 185 300, 210 400, 280 440
              C 340 460, 395 465, 430 455
            " stroke="#003E7E" stroke-width="3.5" stroke-linecap="round" fill="none"></path>

            <g transform="translate(430,455)">
              <circle r="7" stroke="#005FB8" stroke-width="2" fill="none"></circle>
              <line x1="-9" y1="0" x2="9" y2="0" stroke="#005FB8" stroke-width="2"></line>
              <line x1="0" y1="-9" x2="0" y2="9" stroke="#005FB8" stroke-width="2"></line>
            </g>
            <text class="halo" x="444" y="443" font-size="12" fill="#0B1324">Target</text>

            <!-- KOP marker & wedge at new depth -->
            <circle cx="140" cy="220" r="4" fill="#005FB8"></circle>
            <path class="wedge ns" d="M 140 220 L 140 254" />
            <path class="wedge ns" d="M 140 220 L 162 252" />
            <path class="wedge ns" d="M 140 244 A 24 24 0 0 1 158 252" />
            <text class="halo" x="168" y="258" font-size="11" fill="#003E7E">Inclination (DLS)</text>
            <text class="halo" x="124" y="222" text-anchor="end" font-size="12" fill="#0B1324">Kickoff point (KOP)</text>
          </g>

          <!-- Keep Wellhead label on top -->
          <text class="halo" x="140" y="58" text-anchor="middle" font-size="12" fill="#0B1324">Wellhead</text>
        </svg>
      </div>
    </section>
  </div>

  <details class="preview" id="jsonDetails">
    <summary>JSON Preview (live)</summary>
    <pre id="jsonPreview" aria-live="polite"></pre>
  </details>

  <script>
    const UOM = {
      length:{metric:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:m:",imperial:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:ft:"},
      cost:{metric:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fm:",imperial:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:USD%2Fft:"},
      tubingInch:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:in:",
      dls:{metric:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:1%2F30%20dega%2Fm:",imperial:"slb-osdu-dev-sis-internal-hq:reference-data--UnitOfMeasure:0.01%20dega%2Fft:"}
    };

    const defaults = {
      unitSystem:"metric",
      well_trajectory_modelling:true,
      well_unit_cost:15500,
      tubing_size:6.625,
      horizontal_step_out:800,
      kickoff_point:600,
      dls_limit:4
    };

    const M_PER_FT=0.3048, FT_PER_M=1/M_PER_FT, DLS_M_TO_FT=100/(30*FT_PER_M), DLS_FT_TO_M=1/DLS_M_TO_FT;

    const state = JSON.parse(JSON.stringify(defaults));

    const metricBtn   = document.getElementById("metricBtn");
    const imperialBtn = document.getElementById("imperialBtn");
    const costInput   = document.getElementById("well_unit_cost");
    const costUnitSel = document.getElementById("well_cost_unit");
    const tubingInput = document.getElementById("tubing_size");
    const hsoInput    = document.getElementById("horizontal_step_out");
    const kopInput    = document.getElementById("kickoff_point");
    const dlsInput    = document.getElementById("dls_limit");
    const jsonPreview = document.getElementById("jsonPreview");
    const resetBtn    = document.getElementById("resetBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const hsoUnit     = document.getElementById("hso_unit");
    const kopUnit     = document.getElementById("kop_unit");
    const dlsUnit     = document.getElementById("dls_unit");
    const trajChk     = document.getElementById("well_trajectory_modelling");

    const schemToggle = document.getElementById('schemToggle');
    const schemCard   = document.getElementById('schemCard');
    const mainGrid    = document.getElementById('mainGrid');

    const kopGroup = document.getElementById('group_kop');
    const dlsGroup = document.getElementById('group_dls');

    function clampNonNeg(n){ return Math.max(0, Number(n)||0); }
    function roundNum(v,d){ const f=10**d; return Math.round((Number(v)||0)*f)/f; }

    function buildPayload(){
      const isMetric = state.unitSystem === "metric";
      return {
        well_trajectory_modelling: !!state.well_trajectory_modelling,
        allow_incomplete_dev_concept: false,
        multilateral_well_modelling: { multilateral_well_design: false },
        well_unit_cost: roundNum(state.well_unit_cost, 2),
        well_unit_cost_measurement: isMetric ? UOM.cost.metric : UOM.cost.imperial,
        tubing_size: roundNum(state.tubing_size, 3),
        tubing_size_measurement: UOM.tubingInch,
        horizontal_step_out: roundNum(state.horizontal_step_out, 2),
        horizontal_step_out_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        kickoff_point: roundNum(state.kickoff_point, 2),
        kickoff_point_measurement: isMetric ? UOM.length.metric : UOM.length.imperial,
        dls_limit: roundNum(state.dls_limit, 3),
        dls_limit_measurement: isMetric ? UOM.dls.metric : UOM.dls.imperial
      };
    }
    function renderJSON(){ jsonPreview.textContent = JSON.stringify(buildPayload(), null, 2); }

    function setUnitSystem(target){
      if(target === state.unitSystem) return;
      const toImperial = target === "imperial";
      if(toImperial){
        state.horizontal_step_out *= FT_PER_M;
        state.kickoff_point      *= FT_PER_M;
        state.well_unit_cost     *= M_PER_FT;
        state.dls_limit          *= DLS_M_TO_FT;
      }else{
        state.horizontal_step_out *= M_PER_FT;
        state.kickoff_point      *= M_PER_FT;
        state.well_unit_cost     *= FT_PER_M;
        state.dls_limit          *= DLS_FT_TO_M;
      }
      state.unitSystem = target;
      syncInputsFromState();
    }

    function setGroupVisible(group, visible){
      if(!group) return;
      group.style.display = visible ? '' : 'none';                 // keep layout sane
      group.querySelectorAll('input,select,button').forEach(el => el.disabled = !visible); // avoid stray focus
    }

    function updateSchematicMode(){
      const on = !!state.well_trajectory_modelling;

      // swap schematic groups
      const simple = document.getElementById("schem-simple");
      const optim  = document.getElementById("schem-optim");
      if(simple && optim){
        simple.style.display = on ? "none" : "block";
        optim.style.display  = on ? "block" : "none";
      }

      // hide/show left-panel params (why: KOP/DLS only make sense when curvature exists)
      setGroupVisible(kopGroup, on);
      setGroupVisible(dlsGroup, on);
    }

    function syncInputsFromState(){
      trajChk.checked = state.well_trajectory_modelling;

      costInput.value = state.well_unit_cost.toFixed(2);
      costUnitSel.value = state.unitSystem === "metric" ? "USD/m" : "USD/ft";

      tubingInput.value = state.tubing_size;
      hsoInput.value = state.horizontal_step_out.toFixed(2);
      kopInput.value = state.kickoff_point.toFixed(2);
      dlsInput.value = state.dls_limit.toFixed(3);

      const isMetric = state.unitSystem === "metric";
      hsoUnit.textContent = isMetric ? "m" : "ft";
      kopUnit.textContent = isMetric ? "m" : "ft";
      dlsUnit.textContent = isMetric ? "°/30 m" : "°/100 ft";

      metricBtn.classList.toggle("active", isMetric);
      metricBtn.setAttribute("aria-pressed", String(isMetric));
      imperialBtn.classList.toggle("active", !isMetric);
      imperialBtn.setAttribute("aria-pressed", String(!isMetric));

      renderJSON();
      updateSchematicMode();
    }

    metricBtn.addEventListener("click", ()=> setUnitSystem("metric"));
    imperialBtn.addEventListener("click", ()=> setUnitSystem("imperial"));

    costUnitSel.addEventListener("change", (e)=>{
      const desired = e.target.value.endsWith("/m") ? "metric" : "imperial";
      setUnitSystem(desired);
    });

    costInput.addEventListener("input", (e)=>{ state.well_unit_cost = clampNonNeg(e.target.value); renderJSON(); });
    tubingInput.addEventListener("input", (e)=>{ state.tubing_size = clampNonNeg(e.target.value); renderJSON(); });
    hsoInput.addEventListener("input", (e)=>{ state.horizontal_step_out = clampNonNeg(e.target.value); renderJSON(); });
    kopInput.addEventListener("input", (e)=>{ state.kickoff_point = clampNonNeg(e.target.value); renderJSON(); });
    dlsInput.addEventListener("input", (e)=>{ state.dls_limit = clampNonNeg(e.target.value); renderJSON(); });

    trajChk.addEventListener("change", (e)=>{
      state.well_trajectory_modelling = !!e.target.checked;
      renderJSON();
      updateSchematicMode();
    });

    resetBtn.addEventListener("click", ()=>{
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();
    });

    downloadBtn.addEventListener("click", ()=>{
      const data = JSON.stringify(buildPayload(), null, 2);
      const blob = new Blob([data], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "well-design-inputs.json";
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(a.href);
      a.remove();
    });

    function setSchematicVisible(visible){
      schemCard.style.display = visible ? '' : 'none';
      mainGrid.classList.toggle('schem-hidden', !visible);
      schemToggle.textContent = visible ? 'Hide schematic' : 'Show schematic';
      schemToggle.setAttribute('aria-pressed', String(visible));
    }
    schemToggle.addEventListener('click', ()=>{
      const isVisible = schemCard.style.display !== 'none';
      setSchematicVisible(!isVisible);
    });

    (function init(){
      Object.assign(state, JSON.parse(JSON.stringify(defaults)));
      syncInputsFromState();   // ensures correct initial UI & schematic
      setSchematicVisible(true);
    })();
  </script>
</body>
</html>
